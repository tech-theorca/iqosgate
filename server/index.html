<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tag Detected</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #stringsList {
            list-style-type: none;
            padding: 0;
        }
        #stringsList li {
            background: #f0f0f0;
            margin: 5px 0;
            padding: 10px;
            border-radius: 4px;
            word-break: break-all;
        }
        #refreshBtn {
            margin-bottom: 20px;
            padding: 8px 16px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Tag Detected</h1>
    <button id="refreshBtn">Refresh</button>
    <ul id="stringsList"></ul>

    <script>
        const stringsList = document.getElementById('stringsList');
        const refreshBtn = document.getElementById('refreshBtn');

        async function fetchStrings() {
            try {
                const response = await fetch('/strings');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                console.log('Received data:', data);
                stringsList.innerHTML = '';
                if (Array.isArray(data.strings)) {
                    // Reverse the array to show latest data on top
                    data.strings.slice().reverse().forEach(item => {
                        console.log('Item:', item);
                        let str = item.string;
                        let timestamp = item.timestamp;
                        if (typeof str === 'object') {
                            str = JSON.stringify(str);
                        }
                        if (typeof timestamp !== 'string') {
                            timestamp = JSON.stringify(timestamp);
                        }
                        const li = document.createElement('li');
                        li.textContent = str + (timestamp ? ' at ' + timestamp : '');
                        stringsList.appendChild(li);
                    });
                } else {
                    stringsList.innerHTML = '<li>No strings received</li>';
                }
            } catch (error) {
                stringsList.innerHTML = '<li>Error loading strings</li>';
                console.error('Fetch error:', error);
            }
        }

        refreshBtn.addEventListener('click', fetchStrings);

        // Initial fetch
        fetchStrings();

        // Auto refresh every 5 seconds
        setInterval(fetchStrings, 5000);
    </script>
</body>
</html>
